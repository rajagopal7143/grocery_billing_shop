<!DOCTYPE html>
<html>
    <head>
        <title>Add Customer - Grocery Shop</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <style>
            body { font-family: Arial, sans-serif; background: #f9fafb; padding: 20px; color: #333; }
            .form-container {
                max-width: 500px;
                margin: 30px auto;
                background: white;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }
            h1 { text-align: center; color: #1a7bbd; margin-bottom: 20px; }
            label { display: block; margin-top: 15px; font-weight: 600; }
            input, textarea {
                width: 100%;
                padding: 8px 10px;
                margin-top: 6px;
                border: 1.5px solid #ccc;
                border-radius: 6px;
                font-size: 1em;
            }
            button {
                margin-top: 20px;
                background: #1a7bbd;
                color: white;
                font-weight: 700;
                border: none;
                padding: 12px;
                width: 100%;
                border-radius: 6px;
                cursor: pointer;
                font-size: 1.1em;
                transition: background 0.3s;
            }
            button:hover { background: #155c9a; }
            a.back-link {
                display: inline-block;
                margin-top: 20px;
                color: #1a7bbd;
                text-decoration: none;
                font-weight: 600;
            }
            a.back-link:hover { text-decoration: underline; }
            #message {
                margin-top: 15px;
                font-weight: 600;
            }
        </style>
    </head>
    <body>
        <div class="form-container">
            <h1>Add Customer</h1>
            <form id="customerForm">
                <label for="name">Name*</label>
                <input type="text" id="name" name="name" required />

                <label for="email">Email*</label>
                <input type="email" id="email" name="email" required />

                <label for="phone">Phone</label>
                <input type="text" id="phone" name="phone" />

                <label for="address">Address</label>
                <textarea id="address" name="address" rows="3"></textarea>

                <button type="submit">Add Customer</button>
                <div id="message"></div>
            </form>
            <a href="/customers" class="back-link">&#8592; Back to Customer List</a>
        </div>

        <script>
            const form = document.getElementById('customerForm');
            const messageDiv = document.getElementById('message');

            form.addEventListener('submit', async e => {
                e.preventDefault();
                messageDiv.textContent = '';
                messageDiv.style.color = '#000';

                const data = {
                    name: form.name.value.trim(),
                    email: form.email.value.trim(),
                    phone: form.phone.value.trim(),
                    address: form.address.value.trim()
                };

                if (!data.name || !data.email) {
                    messageDiv.textContent = 'Name and Email are required!';
                    messageDiv.style.color = 'red';
                    return;
                }

                try {
                    const token = localStorage.getItem("access_token");
                    const response = await fetch('/api/customers', {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            "Authorization": "Bearer " + token
                        },
                        body: JSON.stringify(data)
                    });

                    if (response.ok) {
                        messageDiv.textContent = 'Customer added successfully! ';
                        messageDiv.style.color = 'green';
                        setTimeout(() => window.location.href = '/customers', 1500);
                    } else {
                        const err = await response.json();
                        messageDiv.style.color = 'red';
                        messageDiv.textContent = err.detail || 'Failed to add customer.';
                    }
                } catch (error) {
                    messageDiv.style.color = 'red';
                    messageDiv.textContent = 'An error occurred. Please try again.';
                }
            });
        </script>
    </body>
    </html>