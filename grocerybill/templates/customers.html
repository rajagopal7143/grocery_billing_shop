<!DOCTYPE html>
<html>
    <head>
        <title>Customers details- Grocery Shop</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <style>
            body { font-family: Arial, sans-serif; background: #f9fafb; margin: 0; padding: 20px; color: #333;}
            h1 {color:#1a7bbd; text-align:center; margin-bottom:20px;}
            table {border-collapse:collapse; width:90%; max-width:900px; margin:auto; background:white; border-radius:8px; box-shadow: 0 4px 16px rgba(0,0,0,0.1);}
            th, td {padding:14px 20px; text-align:left; border-bottom:1px solid #eee;}
            th {background-color:#1a7bbd; color:white;}
            tr:hover {background-color:#f1f5fb;}
            .back-link {
                display: inline-block;
                margin: 15px 20px 10px;
                padding: 8px 14px;
                background-color: #8592b4;
                color: white; text-decoration: none; font-weight: 600; border-radius: 6px;
            }
            @media (max-width:600px){
                table, thead, tbody, th, td, tr {display:block;}
                th {position:sticky; top:0;}
                td {padding-left:50%; position:relative;}
                td::before {position:absolute; top:14px; left:14px; width:45%; white-space:nowrap; font-weight:bold;}
                td:nth-of-type(1)::before {content: "Name";}
                td:nth-of-type(2)::before {content: "Email";}
                td:nth-of-type(3)::before {content: "Phone";}
                td:nth-of-type(4)::before {content: "Address";}
                td:nth-of-type(5)::before {content: "Registered On";}
            }
        </style>
    </head>
    <body>
        <a href="/profile" class="back-link">&#8592; Back to Dashboard</a>
        <h1>Customer List</h1>
        <table id="customersTable">
            <thead>
                <tr>
                    <th>Name</th><th>Email</th><th>Phone</th><th>Address</th><th>Registered On</th>
                </tr>
            </thead>
            <tbody><tr><td colspan="5" style="text-align:center;">Loading customers...</td></tr></tbody>
        </table>
        <script>
            async function loadCustomers() {
                try {
                    const token = localStorage.getItem("access_token");
                    const resp = await fetch('/api/customers', {
                         headers: { "Authorization": "Bearer " + token }
                    });
                    if (!resp.ok) throw new Error("Failed to fetch customers");
                    const customers = await resp.json();

                    const tbody = document.querySelector('#customersTable tbody');
                    tbody.innerHTML = '';

                    customers.forEach(c => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${c.name}</td>
                            <td>${c.email}</td>
                            <td>${c.phone || ''}</td>
                            <td>${c.address || ''}</td>
                            <td>${new Date(c.registered_on).toLocaleDateString()}</td>
                        `;
                        tbody.appendChild(tr);
                    });
                } catch(e) {
                    const tbody = document.querySelector('#customersTable tbody');
                    tbody.innerHTML = '<tr><td colspan="5" style="color:red; text-align:center">Failed to load customers. Please login.</td></tr>';
                    console.error('Failed to load customers:', e);
                }
            }
            loadCustomers();
        </script>
    </body>
    </html>